var b=[{name:"white",value:"#ffffff",code:0},{name:"blue",value:"#1d5aff",code:1},{name:"green",value:"#024913",code:2},{name:"red",value:"#ff2c2c",code:3},{name:"black",value:"#242424",code:4},{name:"yellow",value:"#f2ff1d",code:5},{name:"orange",value:"#ff6b1b",code:6}],d,e,h,k={x:0,y:0,zoom:1},l,m=new WebSocket("ws://"+window.location.href.split("//")[1]+"socket");m.onopen=function(){console.log("Connection open!")};
m.onmessage=function(a){l||(l=JSON.parse(a.data),n());var c=JSON.parse(a.data);c.color&&c.x&&c.y&&(e.fillStyle=b.find(function(a){return a.code==c.color}).value,l[c.x][c.y]=c.color,e.fillRect(k.x+10*c.x,k.y+10*c.y,10,10))};
$(document).ready(function(){b.forEach(function(a){$("#colors").append($("<div></div>").attr("class","color").attr("name",a.name).attr("style","background-color:"+a.value+";width:"+$("#colors").height()+"px"))});$("#pixelfield").attr("width",$("#main").width()).attr("height",$("#main").height());h=document.getElementById("pixelfield");e=h.getContext("2d");h.addEventListener("mousedown",q,!1);e.fillStyle="#ffffff";n(k.x,k.y,k.zoom);h.onmousewheel=function(a){.11>=k.zoom&&0>a.wheelDelta||(k.zoom+=a.wheelDelta/1200,
n(k.x,k.y,k.zoom))};$(".color").click(function(a){function c(a){if(d){n(k.x,k.y,k.z);e.fillStyle=d.value;var c=Math.round(parseInt(a.clientX/k.zoom)/10);a=Math.round(parseInt(a.clientY/k.zoom)/10);c=10*c+k.x%10-10;a=10*a+k.y%10-10;c<k.x||a<k.y||c>k.x+1E3-10||a>k.y+1E3-10?p=!1:(p=!0,e.fillRect(c,a,10,10))}}function g(a){console.log("mousedown");if(d&&p){a=Math.round(parseInt(event.clientX/k.zoom)/10);var f=Math.round(parseInt(event.clientY/k.zoom)/10);a=10*a+k.x%10-10;f=10*f+k.y%10-10;a={x:Math.round((a-
k.x)/10),y:Math.round((f-k.y)/10)};console.log(d);l[a.x][a.y]=d.code;a.color=d.code;m.send(JSON.stringify(a));h.removeEventListener("mousemove",c);h.removeEventListener("mousedown",g);d=null;$(".color").attr("class","color")}}$(".color").attr("class","color");var f=$(a.target);d=b.filter(function(a){return a.name==f.attr("name")})[0];var p;f.attr("class",f.attr("class")+" active");h.addEventListener("mousemove",c,!1);h.addEventListener("mousedown",g,!1)})});
function q(a){function c(a){var c=f.x-a.clientX,g=f.y-a.clientY;f={x:a.clientX,y:a.clientY};k={x:k.x-c/k.zoom,y:k.y-g/k.zoom,zoom:k.zoom};n(k.x,k.y,k.zoom)}function g(){$("#main").removeAttr("style");h.removeEventListener("mousemove",c);h.removeEventListener("mouseup",g)}a={x:a.clientX,y:a.clientY};h.addEventListener("mousemove",c,!1);h.addEventListener("mouseup",g,!1);$("#main").attr("style","cursor:-webkit-grabbing;");var f=a}
function n(a,c,g){$("#position").html("("+Math.round(a)+","+Math.round(c)+")");e.fillStyle="#ffffff";e.setTransform(1,0,0,1,0,0);e.clearRect(0,0,h.width,h.height);e.scale(k.zoom,k.zoom);e.fillRect(a,c,1E3,1E3);r();if(l)for(a=0;100>a;a++)for(c=0;100>c;c++){var f=l[a][c];if(g=b.find(function(a){return a.code==parseInt(f)}))e.fillStyle=g.value,e.fillRect(k.x+10*a,k.y+10*c,10,10)}}
$(window).resize(function(){$("#pixelfield").attr("width",$("#main").width()).attr("height",$("#main").height());e.fillStyle="#ffffff";n(k.x,k.y,k.zoom)});function r(){e.strokeStyle="#7A7574";e.lineWidth=.5;for(var a=0;100>=a;a++)e.beginPath(),e.moveTo(k.x+10*a,k.y),e.lineTo(k.x+10*a,k.y+1E3),e.stroke();for(a=0;100>=a;a++)e.beginPath(),e.moveTo(k.x,k.y+10*a),e.lineTo(k.x+1E3,k.y+10*a),e.stroke()};